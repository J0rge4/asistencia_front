<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel del Alumno</title>
  <link rel="stylesheet" href="../style.css"> <!-- Estilo compartido -->
</head>
<body>
  <header>Panel del Alumno</header>

  <!-- Botón para regresar al menú principal -->
  <div style="margin: 1rem;">
    <button onclick="window.location.href='../index.html'" style="background-color:#c62828; color:white; padding:10px;">⏻ Salir</button>
  </div>

  <!-- Contenedor principal -->
  <div class="container">
    <h2>Consultar Asistencia</h2>

    <!-- Campo de matrícula del alumno -->
    <input type="text" id="matricula" placeholder="Tu matrícula">

    <!-- Campo de fecha -->
    <input type="date" id="fechaConsulta" placeholder="Selecciona la fecha">

    <!-- Botón para consultar -->
    <button onclick="consultar()">Consultar</button>

    <!-- Resultados de asistencia -->
    <h3>Resultados</h3>
    <ul id="resultado"></ul>
  </div>

  <!-- Script que maneja la consulta al backend -->
  <script>
    // Dirección base de la API (reemplázala con tu URL real si es diferente)
    const api = 'https://asistenciabackend-production-f2de.up.railway.app'; // Asegúrate de que la URL esté correcta

    // Función que consulta la asistencia de un alumno
    async function consultar() {
      const mat = document.getElementById('matricula').value.trim(); // obtiene matrícula del input
      const fecha = document.getElementById('fechaConsulta').value;  // Obtiene la fecha del input

      // Validación para asegurarse de que ambos campos estén llenos
      if (!mat) return alert('Escribe tu matrícula');
      if (!fecha) return alert('Selecciona una fecha');

      try {
        // Hacer la solicitud al backend con la matrícula del alumno y la fecha
        const res = await fetch(`${api}/api/alumnos/asistencia/${mat}?fecha=${fecha}`);
        if (!res.ok) throw new Error('No se pudo obtener los datos');
        const data = await res.json();

        const ul = document.getElementById('resultado');
        ul.innerHTML = '';  // Limpiar resultados anteriores

        // Si no hay resultados, mostrar un mensaje
        if (data.length === 0) {
          ul.innerHTML = '<li>No hay registros de asistencia.</li>';
          return;
        }

        // Agregar los resultados al HTML
        data.forEach(r => {
          const li = document.createElement('li'); // Crear nuevo elemento li
          li.textContent = `${r.fecha}: ${r.presente ? '✅ Presente' : '❌ Ausente'}`;
          ul.appendChild(li);  // Agregar el li al ul
        });

      } catch (err) {
        alert('Error al consultar asistencia: ' + err.message);
      }
    }
  </script>

</body>
</html>

