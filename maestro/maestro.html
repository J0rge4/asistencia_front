<!DOCTYPE html> <!-- Documento HTML5 -->
<html lang="es"> <!-- Idioma español -->

<head>
  <meta charset="UTF-8"> <!-- Codificación UTF-8 -->
  <title>Panel del Maestro</title> <!-- Título en la pestaña del navegador -->
  <link rel="stylesheet" href="../style.css"> <!-- Enlace al CSS general -->
</head>

<body>
  <!-- Encabezado principal -->
  <header>Panel del Maestro</header>

  <!-- Botón de salir al menú principal -->
  <div style="margin: 1rem;">
    <button onclick="window.location.href='../index.html'" style="background-color:#c62828; color:white; padding:10px;">⏻ Salir</button>
  </div>

  <!-- Contenedor general -->
  <div class="container">

    <!-- Formulario para registrar un alumno -->
    <h2>Registrar Alumno</h2>
    <input type="text" id="nombre" placeholder="Nombre del alumno"> <!-- Campo nombre -->
    <input type="text" id="matricula" placeholder="Matrícula"> <!-- Campo matrícula -->
    <button onclick="registrar()">Registrar</button> <!-- Botón registrar -->

    <!-- Sección de pase de lista -->
    <h2>Pase de Lista</h2>
    <input type="date" id="fecha"> <!-- Selección de fecha -->
    <ul id="lista"></ul> <!-- Lista de alumnos con checkbox -->
    <button onclick="pasarLista()">Guardar Asistencia</button> <!-- Guardar lista -->

    <!-- Sección para eliminar alumno -->
    <h2>Eliminar Alumno</h2>
    <input type="text" id="matEliminar" placeholder="Matrícula del alumno"> <!-- Campo matrícula -->
    <button onclick="eliminar()">Eliminar</button> <!-- Botón eliminar -->

  </div>

  <!-- Script JavaScript para manejar todas las funciones -->
  <script>
    const api = 'http://localhost:3000/api'; // URL base de la API

    // Cargar alumnos al abrir la página
    window.onload = cargar;

    async function cargar() {
      const res = await fetch(`${api}/alumnos`); // Obtener alumnos
      const alumnos = await res.json(); // Convertir respuesta en JSON
      const ul = document.getElementById('lista');
      ul.innerHTML = ''; // Limpiar lista

      // Agregar alumnos con checkbox
      alumnos.forEach(a => {
        ul.innerHTML += `
          <li>
            <label>
              <input type="checkbox" data-matricula="${a.matricula}">
              ${a.nombre} (${a.matricula})
            </label>
          </li>`;
      });
    }

    // Función para registrar un alumno
    async function registrar() {
      const nombre = document.getElementById('nombre').value.trim();
      const matricula = document.getElementById('matricula').value.trim();
      if (!nombre || !matricula) return alert('Faltan datos');

      const res = await fetch(`${api}/alumnos/registrar`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nombre, matricula })
      });

      const data = await res.json();
      if (data.success) {
        alert('Registrado');
        cargar(); // Recargar la lista de alumnos
      } else {
        alert('Error al registrar');
      }
    }

    // Función para pasar lista
    async function pasarLista() {
      const fecha = document.getElementById('fecha').value;
      if (!fecha) return alert('Selecciona la fecha');

      const checks = document.querySelectorAll('#lista input[type=checkbox]');
      const lista = [];

      checks.forEach(chk => {
        lista.push({
          matricula: chk.dataset.matricula,
          presente: chk.checked
        });
      });

      const res = await fetch(`${api}/asistencia/pasar`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ lista, fecha })
      });

      const data = await res.json();
      if (data.success) alert('Asistencia guardada');
      else alert('Error al guardar');
    }

    // Función para eliminar un alumno
    async function eliminar() {
      const mat = document.getElementById('matEliminar').value.trim();
      if (!mat) return alert('Ingresa una matrícula');

      const res = await fetch(`${api}/alumnos/${mat}`, {
        method: 'DELETE'
      });

      const data = await res.json();
      if (data.success) {
        alert('Alumno eliminado');
        cargar(); // Recargar lista
      } else {
        alert('Error al eliminar');
      }
    }
  </script>
</body>
</html>
